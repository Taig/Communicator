machine:
  services:
    - docker

dependencies:
  pre:
    - docker login -e $DOCKER_HUB_EMAIL -u $DOCKER_HUB_USER -p $DOCKER_HUB_PASSWORD
  override:
    - docker pull taig/communicator:latest || true

test:
  override:
    - docker build -t taig/communicator:latest .
    - docker push taig/communicator:latest
    - docker run -e CODECOV_TOKEN=$CODECOV_TOKEN --entrypoint="./test.sh" -v "$PWD:/communicator/" taig/communicator:latest